<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Staff Loan EMI - MPGB RO Jabalpur</title>

<style>
body{
  margin:0;
  font-family:'Segoe UI',Arial;
  background:linear-gradient(135deg,#e8f5e9,#ffffff);
}

.header{
  background:#006400;
  color:white;
  text-align:center;
  padding:18px;
  font-size:20px;
  font-weight:bold;
}

.container{
  max-width:1100px;
  margin:30px auto;
  background:white;
  padding:25px;
  border-radius:12px;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
}

h2{
  text-align:center;
  color:#006400;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:10px;
}

input{
  padding:8px;
  width:100%;
  border:1px solid #ccc;
  border-radius:6px;
}

button{
  background:#006400;
  color:white;
  border:none;
  padding:10px;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
  margin-top:10px;
}

button:hover{background:#004d00;}

.result{
  margin-top:20px;
  background:#f1f8f4;
  padding:15px;
  border-radius:8px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:11px;
}

th,td{
  border:1px solid #ccc;
  padding:5px;
  text-align:center;
}

th{
  background:#006400;
  color:white;
}

.back{
  display:block;
  text-align:center;
  margin-top:20px;
  text-decoration:none;
  color:#006400;
  font-weight:bold;
}

@media print {
  button,.back{display:none}
  body{background:white}
  .container{box-shadow:none;margin:0}
}
</style>
</head>

<body>

<div class="header">
MPGB RO Jabalpur - Staff Loan EMI (2:1 Simple Reducing)
</div>

<div class="container">

<h2>Staff Loan Calculator</h2>

<div class="grid">
<input type="number" id="amount" placeholder="Loan Amount (₹)">
<input type="number" id="rate" placeholder="Annual Interest Rate (%)">
<input type="number" id="tenure" placeholder="Tenure (Years)">
</div>

<button onclick="calculateStaff()">Calculate</button>
<button onclick="window.print()">Print</button>
<button onclick="downloadPDF()">Download PDF</button>

<div class="result" id="summary" style="display:none;"></div>

<h3 style="color:#006400;">Monthly Amortization Schedule</h3>
<table id="schedule"></table>

<a href="emi.html" class="back">⬅ Back to Normal EMI</a>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>

function format(n){
  return n.toLocaleString("en-IN",{maximumFractionDigits:2});
}

let savedData={};

function calculateStaff(){

let P=parseFloat(amount.value);
let annual=parseFloat(rate.value);
let years=parseFloat(tenure.value);

if(!P||!annual||!years){
  alert("Fill all fields");
  return;
}

let principalYears=(2/3)*years;
let interestYears=(1/3)*years;

let principalMonths=Math.round(principalYears*12);
let interestMonths=Math.round(interestYears*12);

let monthlyPrincipal=P/principalMonths;
let r=annual/12/100;

let balance=P;
let accumulatedInterest=0;

let table=document.getElementById("schedule");
table.innerHTML="<tr><th>Month</th><th>Principal Repayment</th><th>Interest Repayment</th><th>Outstanding (Principal + Accrued Interest)</th></tr>";

/* Phase 1 – Principal Repayment */
for(let i=1;i<=principalMonths;i++){

  let interest=balance*r;
  accumulatedInterest+=interest;

  balance-=monthlyPrincipal;

  let outstanding=balance+accumulatedInterest;

  table.innerHTML+=`<tr>
  <td>${i}</td>
  <td>${format(monthlyPrincipal)}</td>
  <td>0</td>
  <td>${format(outstanding>0?outstanding:0)}</td>
  </tr>`;
}

/* Phase 2 – Interest Repayment */

let monthlyInterestRecovery=accumulatedInterest/interestMonths;
let remainingInterest=accumulatedInterest;

for(let i=1;i<=interestMonths;i++){

  remainingInterest-=monthlyInterestRecovery;

  table.innerHTML+=`<tr>
  <td>${principalMonths+i}</td>
  <td>0</td>
  <td>${format(monthlyInterestRecovery)}</td>
  <td>${format(remainingInterest>0?remainingInterest:0)}</td>
  </tr>`;
}

document.getElementById("summary").innerHTML=`
<h3>Summary</h3>
<p><strong>Principal Phase:</strong> ${principalYears.toFixed(0)} Years</p>
<p><strong>Interest Phase:</strong> ${interestYears.toFixed(0)} Years</p>
<p><strong>Monthly Principal (Phase 1):</strong> ₹ ${format(monthlyPrincipal)}</p>
<p><strong>Total Accumulated Interest:</strong> ₹ ${format(accumulatedInterest)}</p>
<p><strong>Monthly Interest Recovery (Phase 2):</strong> ₹ ${format(monthlyInterestRecovery)}</p>
<p><strong>Total Payment:</strong> ₹ ${format(P+accumulatedInterest)}</p>
`;

document.getElementById("summary").style.display="block";

savedData={
  P,annual,years,principalYears,interestYears,
  monthlyPrincipal,accumulatedInterest,monthlyInterestRecovery
};

}

async function downloadPDF(){

if(!savedData.P){
  alert("Please calculate first");
  return;
}

const { jsPDF } = window.jspdf;
const doc = new jsPDF();

doc.setFontSize(14);
doc.text("Madhya Pradesh Gramin Bank",20,20);
doc.text("RO Jabalpur - Staff Loan EMI Report",20,30);

doc.setFontSize(11);
let y=45;

doc.text("Loan Amount: ₹ "+format(savedData.P),20,y); y+=8;
doc.text("Interest Rate: "+savedData.annual+" %",20,y); y+=8;
doc.text("Tenure: "+savedData.years+" Years",20,y); y+=10;

doc.text("Principal Phase: "+savedData.principalYears.toFixed(0)+" Years",20,y); y+=8;
doc.text("Interest Phase: "+savedData.interestYears.toFixed(0)+" Years",20,y); y+=8;
doc.text("Total Accumulated Interest: ₹ "+format(savedData.accumulatedInterest),20,y); y+=8;
doc.text("Total Payment: ₹ "+format(savedData.P+savedData.accumulatedInterest),20,y);

doc.save("MPGB_Staff_Loan_EMI_Report.pdf");

}

</script>

</body>
</html>
