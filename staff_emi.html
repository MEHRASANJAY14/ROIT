<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MPGB Staff Loan EMI</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f4f6f9;
}

.header{
  background:#006400;
  color:white;
  text-align:center;
  padding:12px;
  font-size:16px;
  font-weight:bold;
}

.container{
  max-width:1400px;
  margin:15px auto;
  background:white;
  padding:18px;
  border-radius:6px;
  box-shadow:0 3px 10px rgba(0,0,0,0.08);
}

input{
  padding:8px;
  width:100%;
  max-width:600px;
  margin-bottom:10px;
  border:1px solid #ccc;
  border-radius:4px;
  font-size:14px;
}

button{
  background:#006400;
  color:white;
  border:none;
  padding:7px 12px;
  border-radius:4px;
  cursor:pointer;
  font-size:13px;
  margin-right:6px;
}

button:hover{background:#004d00;}

.result{
  margin-top:12px;
  margin-bottom:15px;
  background:#eef9f1;
  padding:14px;
  border-radius:6px;
  font-size:14px;
  line-height:1.6em;
}

.table-wrapper{
  overflow-x:auto;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
  table-layout:fixed;
}

th,td{
  border:1px solid #ddd;
  padding:8px 8px;
  text-align:center;
}

th:nth-child(1), td:nth-child(1){ width:60px; }
th:nth-child(2), td:nth-child(2){ width:120px; }
th:nth-child(3), td:nth-child(3){ width:110px; }
th:nth-child(4), td:nth-child(4){ width:110px; }
th:nth-child(5), td:nth-child(5){ width:120px; }
th:nth-child(6), td:nth-child(6){ width:140px; }

th{
  background:#006400;
  color:white;
}

/* PRINT ONLY TABLE */
@media print{

  @page{
    size:A4 landscape;
    margin:10mm;
  }

  body{
    background:white;
  }

  .header,
  input,
  button,
  .result{
    display:none !important;
  }

  .container{
    box-shadow:none;
    margin:0;
    padding:0;
  }

}
</style>
</head>

<body>

<div class="header">
MPGB RO Jabalpur - Staff Loan EMI (Tier Based 3:1 Model)
</div>

<div class="container">

<input type="number" id="amount" placeholder="Loan Amount (₹)">
<input type="number" id="tenure" placeholder="Tenure (Months)">

<button onclick="calculateStaff()">Calculate</button>
<button onclick="window.print()">Print</button>

<div class="result" id="summary" style="display:none;"></div>

<div class="table-wrapper">
<table id="schedule"></table>
</div>
<a href="index.html" class="back">⬅ Back to Dashboard</a>
</div>

<script>

function format(n){
  return Number(n).toFixed(2);
}

function calculateStaff(){

let P=parseFloat(amount.value);
let totalMonths=parseInt(tenure.value);

if(!P||!totalMonths){
  alert("Fill all fields");
  return;
}

/* 3:1 Ratio */
let principalMonths=Math.round((3/4)*totalMonths);
let interestMonths=totalMonths-principalMonths;

/* Slab Split */
let slab1=Math.min(P,4000000);
let slab2=P>4000000?P-4000000:0;

let balance1=slab1;
let balance2=slab2;

let monthlyPrincipal=P/principalMonths;

let r1=5.5/12/100;
let r2=6/12/100;

let accumulatedInterest=0;
let slab1InterestTotal=0;
let slab2InterestTotal=0;

let table=document.getElementById("schedule");
table.innerHTML="";

/* Header */
let headerRow=table.insertRow();
headerRow.innerHTML=
"<th>Month</th>"+
"<th>Principal EMI</th>"+
"<th>5.5%</th>"+
"<th>6%</th>"+
"<th>Total Int</th>"+
"<th>Outstanding</th>";

/* Phase 1 */
for(let i=1;i<=principalMonths;i++){

  let reductionRatio = monthlyPrincipal / P;

  let principal1 = balance1 * reductionRatio;
  let principal2 = balance2 * reductionRatio;

  let interest1 = balance1*r1;
  let interest2 = balance2*r2;

  let totalInterestMonth = interest1 + interest2;

  slab1InterestTotal += interest1;
  slab2InterestTotal += interest2;
  accumulatedInterest += totalInterestMonth;

  balance1 -= principal1;
  balance2 -= principal2;

  let totalOutstanding = (balance1+balance2) + accumulatedInterest;

  let row=table.insertRow();

  row.insertCell(0).innerText=i;
  row.insertCell(1).innerText=format(monthlyPrincipal);
  row.insertCell(2).innerText=format(interest1);
  row.insertCell(3).innerText=format(interest2);
  row.insertCell(4).innerText=format(totalInterestMonth);
  row.insertCell(5).innerText=format(totalOutstanding);
}

/* Phase 2 */
let monthlyInterestRecovery=accumulatedInterest/interestMonths;
let remainingInterest=accumulatedInterest;

for(let i=1;i<=interestMonths;i++){

  remainingInterest-=monthlyInterestRecovery;

  let row=table.insertRow();

  row.insertCell(0).innerText=principalMonths+i;
  row.insertCell(1).innerText="0";
  row.insertCell(2).innerText="0";
  row.insertCell(3).innerText="0";
  row.insertCell(4).innerText=format(monthlyInterestRecovery);
  row.insertCell(5).innerText=format(remainingInterest);
}

/* UPDATED SUMMARY */

document.getElementById("summary").innerHTML=
"<b>Loan Amount:</b> "+format(P)+"<br>"+
"<b>Total Tenure:</b> "+totalMonths+" Months<br>"+
"<b>Principal Phase:</b> "+principalMonths+" Months<br>"+
"<b>Interest Phase:</b> "+interestMonths+" Months<br><hr>"+

"<b>Monthly Principal EMI:</b> "+format(monthlyPrincipal)+"<br>"+
"<b>Monthly Interest EMI:</b> "+format(monthlyInterestRecovery)+"<br><hr>"+

"<b>5.5% Interest on "+format(slab1)+" :</b> "+format(slab1InterestTotal)+"<br>"+
"<b>6% Interest on "+format(slab2)+" :</b> "+format(slab2InterestTotal)+"<br><hr>"+

"<b>Total Interest:</b> "+format(accumulatedInterest)+"<br>"+
"<b>Total Payment:</b> "+format(P+accumulatedInterest);

document.getElementById("summary").style.display="block";

}

</script>

</body>
</html>


