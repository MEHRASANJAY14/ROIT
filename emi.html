<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Advanced EMI Calculator - MPGB RO Jabalpur</title>

<style>
body{
  margin:0;
  font-family:'Segoe UI',Arial;
  background:linear-gradient(135deg,#e8f5e9,#ffffff);
}

.header{
  background:#006400;
  color:white;
  text-align:center;
  padding:18px;
  font-size:20px;
  font-weight:bold;
}

.container{
  max-width:900px;
  margin:30px auto;
  background:white;
  padding:25px;
  border-radius:12px;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
}

h2{
  text-align:center;
  color:#006400;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:10px;
}

input{
  padding:8px;
  border:1px solid #ccc;
  border-radius:6px;
  width:100%;
}

button{
  background:#006400;
  color:white;
  border:none;
  padding:10px;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
  margin-top:10px;
}

button:hover{background:#004d00;}

.result{
  margin-top:20px;
  background:#f1f8f4;
  padding:15px;
  border-radius:8px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:12px;
}

th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}

th{
  background:#006400;
  color:white;
}

.back{
  display:block;
  text-align:center;
  margin-top:20px;
  text-decoration:none;
  color:#006400;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">
MPGB RO Jabalpur - Advanced EMI Calculator
</div>

<div class="container">

<h2>Loan EMI Calculator</h2>

<div class="grid">
<input type="number" id="amount" placeholder="Loan Amount (₹)">
<input type="number" id="rate" placeholder="Annual Interest Rate (%)">
<input type="number" id="tenure" placeholder="Tenure (Months)">
<input type="number" id="fee" placeholder="Processing Fee (%)">
<input type="number" id="prepay" placeholder="Prepayment Amount (Optional)">
</div>

<button onclick="calculate()">Calculate</button>

<hr style="margin:25px 0;">

<div style="text-align:center;">
  <p style="font-weight:bold;color:#006400;">
    Staff Loan (3:1 Structure - Simple Reducing)?
  </p>
  <a href="staff_emi.html" 
     style="display:inline-block;
            padding:10px 20px;
            background:#006400;
            color:white;
            text-decoration:none;
            border-radius:6px;
            font-weight:bold;">
    Click Here for Staff EMI Calculator
  </a>
</div>

<button onclick="window.print()">Print</button>

<div class="result" id="result" style="display:none;">
<p><strong>Monthly EMI:</strong> ₹ <span id="emi"></span></p>
<p><strong>Total Interest:</strong> ₹ <span id="interest"></span></p>
<p><strong>Total Payment:</strong> ₹ <span id="total"></span></p>
<p><strong>Processing Fee:</strong> ₹ <span id="processing"></span></p>
<p><strong>Net Disbursement:</strong> ₹ <span id="net"></span></p>
</div>

<h3 style="color:#006400;">Amortization Schedule</h3>
<table id="schedule"></table>

<a href="index.html" class="back">⬅ Back to Dashboard</a>

</div>

<script>

function format(n){
  return n.toLocaleString("en-IN",{maximumFractionDigits:2});
}

function calculate(){

let P=parseFloat(amount.value);
let annual=parseFloat(rate.value);
let months=parseFloat(tenure.value);   // NOW IN MONTHS
let fee=parseFloat(document.getElementById("fee").value)||0;
let prepay=parseFloat(document.getElementById("prepay").value)||0;

if(!P||!annual||!months){
  alert("Fill required fields");
  return;
}

let r=annual/12/100;
let n=months;   // DIRECT MONTHS USED

let EMI=(P*r*Math.pow(1+r,n))/(Math.pow(1+r,n)-1);

let totalPayment=EMI*n;
let totalInterest=totalPayment-P;

let processing=P*(fee/100);
let net=P-processing;

document.getElementById("emi").innerText=format(EMI);
document.getElementById("interest").innerText=format(totalInterest);
document.getElementById("total").innerText=format(totalPayment);
document.getElementById("processing").innerText=format(processing);
document.getElementById("net").innerText=format(net);

document.getElementById("result").style.display="block";

generateSchedule(P,r,n,EMI);

}

function generateSchedule(P,r,n,EMI){

let table=document.getElementById("schedule");
table.innerHTML="<tr><th>Month</th><th>EMI</th><th>Interest</th><th>Principal</th><th>Balance</th></tr>";

let balance=P;

for(let i=1;i<=n;i++){

let interest=balance*r;
let principal=EMI-interest;
balance-=principal;

table.innerHTML+=`<tr>
<td>${i}</td>
<td>${format(EMI)}</td>
<td>${format(interest)}</td>
<td>${format(principal)}</td>
<td>${format(balance>0?balance:0)}</td>
</tr>`;

if(balance<=0) break;

}

}

</script>

</body>
</html>
